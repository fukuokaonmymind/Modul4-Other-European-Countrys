<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wine Master Class : Module 4 - Tsuyoshi Satomi</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mrs+Saint+Delafield&family=Shippori+Mincho:wght@400;500;700&family=Zen+Kaku+Gothic+New:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            /* Global Theme */
            --bg-base: #F9F8F4; /* 羊皮紙 Off-White */
            --text-ink: #2C2C2C;
            --gold-accent: #C5A059;
            --gold-light: #E8D5A8;
            
            /* Dynamic Chapter Colors (Default) */
            --chapter-color: #C5A059;
            
            /* Specific Chapter Colors */
            --color-spain: #C0392B; /* Vivid Red */
            --color-germany: #117864; /* Slate Green */
            --color-austria: #F1C40F; /* Imperial Gold */
            --color-swiss: #E74C3C; /* Swiss Red */
            --color-hungary: #D35400; /* Tokaji Amber */
            --color-portugal: #2E86C1; /* Atlantic Blue */
            --color-others: #8E44AD; /* Royal Purple */

            /* Grape Colors */
            --grape-red: #922B21; /* Deep Red */
            --grape-white: #50931d; /* Fresh Green */

            /* Typography */
            --font-heading: 'Shippori Mincho', serif;
            --font-body: 'Zen Kaku Gothic New', sans-serif;
            --font-sign: 'Mrs Saint Delafield', cursive;
        }

        /* Reset & Base */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background-color: var(--bg-base);
            color: var(--text-ink);
            font-family: var(--font-body);
            line-height: 1.9;
            overflow-x: hidden;
            word-wrap: break-word;
        }
        
        h1, h2, h3, h4, h5 { font-family: var(--font-heading); }
        p { margin-bottom: 1.5rem; text-align: justify; }
        strong { color: var(--text-ink); font-weight: 700; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-base); }
        ::-webkit-scrollbar-thumb { background: var(--gold-accent); border-radius: 4px; }

        /* --- Header & Hero --- */
        header {
            height: 90vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            background: radial-gradient(circle at center, rgba(255,255,255,0) 0%, rgba(249,248,244,1) 80%), url('https://images.unsplash.com/photo-1506377247377-2a5b3b417ebb?auto=format&fit=crop&q=80') no-repeat center center/cover;
        }
        
        .header-content {
            text-align: center;
            padding: 3rem;
            border: 2px solid var(--gold-accent);
            background: rgba(249, 248, 244, 0.85);
            backdrop-filter: blur(10px);
            max-width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .signature {
            font-family: var(--font-sign);
            font-size: clamp(2.5rem, 5vw, 4rem);
            color: var(--text-ink);
            margin-bottom: 0.5rem;
        }

        .module-title {
            font-size: clamp(1.2rem, 3vw, 2rem);
            letter-spacing: 0.1em;
            color: var(--gold-accent);
            text-transform: uppercase;
        }

        /* Flags Row */
        .flag-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        .flag-icon {
            width: 40px;
            height: 28px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border-radius: 2px;
            transition: transform 0.3s;
            cursor: pointer;
        }
        .flag-icon:hover { transform: scale(1.2); z-index: 10; }
        .flag-icon:active { transform: scale(0.95); }

        .scroll-indicator {
            position: absolute;
            bottom: 2rem;
            animation: bounce 2s infinite;
            color: var(--gold-accent);
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* --- Navigation --- */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background: var(--gold-accent);
            width: 0%;
            z-index: 1001;
            transition: width 0.2s ease;
        }

        .nav-dots {
            position: fixed;
            left: 2rem;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            z-index: 1000;
        }

        .nav-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid var(--gold-accent);
            background: transparent;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .nav-dot.active {
            background: var(--gold-accent);
            transform: scale(1.3);
        }

        .nav-dot::after {
            content: attr(data-label);
            position: absolute;
            left: 25px;
            top: -5px;
            font-size: 0.8rem;
            color: var(--text-ink);
            opacity: 0;
            white-space: nowrap;
            transition: opacity 0.3s;
            font-family: var(--font-heading);
            background: rgba(255,255,255,0.8);
            padding: 2px 6px;
            border-radius: 4px;
            pointer-events: none;
        }

        .nav-dot:hover::after { opacity: 1; }

        /* --- Main Content --- */
        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 4rem 2rem;
        }

        section {
            margin-bottom: 10rem;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s ease-out;
            padding-top: 4rem;
        }
        section.visible { opacity: 1; transform: translateY(0); }

        .section-header {
            text-align: center;
            margin-bottom: 5rem;
            position: relative;
        }
        
        .section-number {
            font-family: var(--font-sign);
            font-size: 6rem;
            color: var(--chapter-color);
            opacity: 0.1;
            position: absolute;
            top: -3rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: -1;
        }

        .section-title {
            font-size: clamp(2.5rem, 5vw, 3.5rem);
            color: var(--text-ink);
            border-bottom: 3px solid var(--chapter-color);
            display: inline-block;
            padding-bottom: 0.5rem;
        }

        .intro-text {
            font-size: 1.1rem;
            text-align: justify;
            margin-bottom: 3rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            line-height: 2;
        }

        /* --- Interactive Map (Pannable) --- */
        .map-wrapper {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .map-container {
            width: 100%;
            background: #DCECF5;
            border: 1px solid var(--gold-light);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: 600px; 
            cursor: grab;
            touch-action: none;
        }
        .map-container:active { cursor: grabbing; }

        svg.europe-map {
            width: 100%;
            height: 100%;
            display: block;
            pointer-events: none; 
        }

        .map-region {
            pointer-events: auto; 
            stroke: #FFF;
            stroke-width: 1.5;
            transition: all 0.4s ease;
            cursor: pointer;
            filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.1));
        }

        .map-region:hover {
            filter: drop-shadow(0 0 15px rgba(255,255,255,0.8));
            stroke: var(--gold-accent);
            stroke-width: 2.5;
            z-index: 10;
        }

        .map-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
            pointer-events: auto;
        }
        .map-btn {
            width: 40px;
            height: 40px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            color: #555;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background 0.2s;
        }
        .map-btn:hover { background: #f0f0f0; color: var(--gold-accent); }

        /* Region Colors */
        #region-spain { fill: #E6B0AA; } #region-spain:hover { fill: #C0392B; }
        #region-germany { fill: #A2D9CE; } #region-germany:hover { fill: #117864; }
        #region-austria { fill: #F9E79F; } #region-austria:hover { fill: #F1C40F; }
        #region-hungary { fill: #EDBB99; } #region-hungary:hover { fill: #D35400; }
        #region-uk { fill: #D7BDE2; } #region-uk:hover { fill: #8E44AD; }
        #region-portugal { fill: #AED6F1; } #region-portugal:hover { fill: #2E86C1; }
        #region-swiss { fill: #D5D8DC; } #region-swiss:hover { fill: #E74C3C; }

        .map-label {
            font-family: var(--font-heading);
            font-size: 16px;
            fill: #2C2C2C;
            font-weight: bold;
            pointer-events: none;
            text-anchor: middle;
            text-shadow: 0 0 5px white;
        }

        /* Map List */
        .map-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        .map-list-item {
            padding: 1rem 1.5rem;
            background: white;
            border-left: 5px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            font-family: var(--font-heading);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .map-list-item:hover { transform: translateX(5px); background: #fafafa; }
        .map-list-item.spain { border-color: var(--color-spain); }
        .map-list-item.germany { border-color: var(--color-germany); }
        .map-list-item.austria { border-color: var(--color-austria); }
        .map-list-item.swiss { border-color: var(--color-swiss); }
        .map-list-item.hungary { border-color: var(--color-hungary); }
        .map-list-item.portugal { border-color: var(--color-portugal); }
        .map-list-item.others { border-color: var(--color-others); }

        /* --- Content Blocks --- */
        .glossary-term {
            color: var(--chapter-color);
            font-weight: 500;
            cursor: pointer;
            text-decoration: underline;
            text-decoration-style: dotted;
            text-underline-offset: 3px;
            transition: color 0.3s;
        }
        .glossary-term:hover { background-color: rgba(197, 160, 89, 0.1); }

        .region-detail-block {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 3rem;
            margin-bottom: 4rem;
            background: white;
            padding: 3rem;
            border-radius: 8px;
            border-top: 4px solid var(--chapter-color);
            box-shadow: 0 10px 40px rgba(0,0,0,0.05);
        }
        
        /* Germany Layout Fix */
        #germany .region-detail-block:first-of-type {
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            align-items: start;
        }
        
        .region-text h3 {
            font-size: 1.8rem;
            color: var(--chapter-color);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 0.5rem;
            word-break: break-word;
            flex-wrap: wrap;
        }
        .region-text h4 {
            font-size: 1.2rem;
            margin-top: 2rem;
            margin-bottom: 0.8rem;
            color: #333;
            font-weight: 700;
            border-left: 3px solid var(--chapter-color);
            padding-left: 10px;
        }
        .region-text p { margin-bottom: 1rem; text-align: justify; line-height: 1.9; color: #444; }
        .region-text ul { margin-bottom: 1.5rem; padding-left: 1.2rem; }
        .region-text li { margin-bottom: 0.5rem; color: #444; }

        .region-highlights {
            background: #FDFDFD;
            padding: 2rem;
            border-radius: 8px;
            border: 1px solid #eee;
            height: fit-content;
        }
        .region-highlights h4 {
            font-size: 1.1rem;
            color: var(--chapter-color);
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            text-align: center;
        }
        .highlight-item {
            margin-bottom: 1.2rem;
            font-size: 0.95rem;
            border-bottom: 1px dashed #eee;
            padding-bottom: 0.5rem;
        }
        .highlight-item strong { display: block; color: #333; margin-bottom: 0.3rem; }
        
        /* --- Ampelography Grid --- */
        .grape-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2.5rem;
            padding: 1rem 0 3rem 0;
            width: 100%;
        }
        .grape-card {
            background: white;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 2.5rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.06);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            --card-accent: var(--chapter-color); /* Default */
        }
        /* Grape Color Overrides */
        .grape-card.red { --card-accent: var(--grape-red); }
        .grape-card.white { --card-accent: var(--grape-white); }
        
        .grape-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .grape-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 5px;
            background: var(--card-accent);
        }
        .grape-name {
            font-family: var(--font-heading);
            font-size: 1.6rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .grape-desc {
            font-size: 0.95rem;
            color: #555;
            margin-bottom: 2rem;
            line-height: 1.8;
            min-height: 5em; 
        }
        .stat-row { display: flex; align-items: center; margin-top: 0.8rem; font-size: 0.9rem; }
        .stat-label { width: 70px; font-weight: bold; color: #888; text-transform: uppercase; font-size: 0.75rem; }
        .stat-bar-bg { flex-grow: 1; height: 8px; background: #eee; border-radius: 4px; }
        .stat-bar-fill { height: 100%; background: var(--card-accent); border-radius: 4px; }

        /* --- Chronicles of Vin (Timeline) --- */
        .timeline-container {
            position: relative;
            padding: 2rem 0;
            margin: 4rem 0;
        }
        .timeline-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--gold-light);
            transform: translateX(-50%);
        }
        .timeline-event {
            position: relative;
            width: 45%;
            padding: 2.5rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 3rem;
            border-left: 4px solid var(--chapter-color);
        }
        .timeline-event:nth-child(odd) { left: 0; text-align: right; border-left: none; border-right: 4px solid var(--chapter-color); }
        .timeline-event:nth-child(even) { left: 55%; }
        
        .timeline-event::after {
            content: '';
            position: absolute;
            top: 2rem;
            width: 20px;
            height: 20px;
            background: var(--chapter-color);
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 0 0 2px var(--gold-light);
        }
        .timeline-event:nth-child(odd)::after { right: -12.2%; }
        .timeline-event:nth-child(even)::after { left: -12.2%; }

        .timeline-year {
            font-family: var(--font-sign);
            font-size: 3rem;
            color: var(--gold-accent);
            line-height: 1;
            margin-bottom: 0.5rem;
        }
        .timeline-title { font-family: var(--font-heading); font-size: 1.4rem; font-weight: bold; margin-bottom: 1rem; }

        /* --- Audio Buttons & Others --- */
        .audio-btn {
            background: transparent; border: 1px solid #ccc; border-radius: 50%;
            width: 36px; height: 36px; font-size: 1rem; color: #555;
            cursor: pointer; display: inline-flex; align-items: center; justify-content: center;
            margin-left: 10px; transition: all 0.2s;
        }
        .audio-btn:hover { background: var(--chapter-color); color: white; border-color: var(--chapter-color); }

        /* --- Modals --- */
        dialog {
            border: none; border-radius: 8px; padding: 0;
            max-width: 600px; width: 90%; max-height: 85vh;
            background: white; box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            margin: auto;
        }
        dialog::backdrop { background: rgba(44, 44, 44, 0.7); backdrop-filter: blur(5px); }
        .modal-header { background: var(--chapter-color); color: white; padding: 1.5rem; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 3rem; overflow-y: auto; color: #444; line-height: 2; font-size: 1.05rem; }
        .modal-close { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; }

        /* --- Quiz Section --- */
        .quiz-container {
            background: white; padding: 5rem; border: 1px solid var(--gold-light);
            border-radius: 12px; text-align: center; max-width: 900px; margin: 0 auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.05);
        }
        .question-card { display: none; animation: fadeIn 0.5s; }
        .question-card.active { display: block; }
        .question-text { font-size: 1.8rem; font-weight: bold; margin-bottom: 3rem; font-family: var(--font-heading); color: #333; line-height: 1.4; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        .option-btn {
            padding: 1.5rem; background: #F8F8F8; border: 1px solid #E0E0E0; cursor: pointer;
            transition: all 0.3s; font-family: var(--font-body); font-size: 1.1rem; border-radius: 6px;
        }
        .option-btn:hover { background: var(--gold-light); border-color: var(--gold-accent); transform: translateY(-2px); }
        
        #quiz-feedback-title { font-family: var(--font-heading); font-size: 2rem; }
        #quiz-feedback-content { font-size: 1.1rem; margin-top: 1rem; }
        
        /* Centered Back to Map Button */
        .back-to-map {
            display: block; 
            margin: 3rem auto; 
            padding: 1rem 3rem; 
            background: transparent;
            border: 2px solid var(--chapter-color); 
            color: var(--chapter-color); 
            cursor: pointer;
            font-family: var(--font-heading); 
            font-weight: bold; 
            transition: all 0.3s;
            text-transform: uppercase; 
            letter-spacing: 0.1em;
            width: fit-content;
            text-align: center;
        }
        .back-to-map:hover { background: var(--chapter-color); color: white; }
        
        #quiz-intro-text {
            font-size: 1.1rem;
            line-height: 2;
            margin-bottom: 2rem;
            color: #444;
        }

        /* Media Queries */
        @media (max-width: 900px) {
            .region-detail-block, #germany .region-detail-block:first-of-type { grid-template-columns: 1fr; gap: 2rem; padding: 2rem; }
            .map-container { height: 400px; }
            .timeline-event { width: 100%; left: 0 !important; margin-bottom: 2rem; border-right: none; border-left: 4px solid var(--chapter-color); text-align: left !important; }
            .timeline-event::after { left: -12px !important; }
            .timeline-line { left: 0; }
        }
        @media (max-width: 768px) {
            .nav-dots {
                left: 0; top: auto; bottom: 0; width: 100%; flex-direction: row;
                justify-content: center; background: rgba(255,255,255,0.95); padding: 1rem;
                transform: none; box-shadow: 0 -5px 10px rgba(0,0,0,0.05);
            }
            .nav-dot::after { display: none; }
            .options-grid { grid-template-columns: 1fr; }
            .section-title { font-size: 2rem; }
            section { margin-bottom: 6rem; }
            .map-list { grid-template-columns: 1fr; }
            .flag-row { gap: 10px; }
            .flag-icon { width: 30px; height: 20px; }
        }

        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} 60% {transform: translateY(-5px);} }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    </style>
</head>
<body>

    <!-- Progress Bar -->
    <div class="progress-bar" id="progressBar"></div>

    <!-- Navigation -->
    <nav class="nav-dots">
        <div class="nav-dot active" data-label="Top" onclick="scrollToId('top')"></div>
        <div class="nav-dot" data-label="Atlas" onclick="scrollToId('atlas')"></div>
        <div class="nav-dot" data-label="Spain" onclick="scrollToId('spain')"></div>
        <div class="nav-dot" data-label="Germany" onclick="scrollToId('germany')"></div>
        <div class="nav-dot" data-label="Austria" onclick="scrollToId('austria')"></div>
        <div class="nav-dot" data-label="Swiss" onclick="scrollToId('swiss')"></div>
        <div class="nav-dot" data-label="Hungary" onclick="scrollToId('hungary')"></div>
        <div class="nav-dot" data-label="Portugal" onclick="scrollToId('portugal')"></div>
        <div class="nav-dot" data-label="Others" onclick="scrollToId('others')"></div>
        <div class="nav-dot" data-label="History" onclick="scrollToId('history')"></div>
        <div class="nav-dot" data-label="Validation" onclick="scrollToId('quiz')"></div>
    </nav>

    <!-- Header -->
    <header id="top">
        <div class="header-content">
            <div class="signature">Tsuyoshi Satomi</div>
            <div class="module-title">Wine Master Class : Module 4</div>
            <p style="margin-top: 1rem; font-style: italic; color: #555; font-size: 1.2rem; text-align: center;">The Grand Tour of Europe</p>
            
            <!-- Flag Row (Click to Speak) -->
            <div class="flag-row">
                <!-- UK -->
                <svg class="flag-icon" viewBox="0 0 60 40" onclick="speakNative('United Kingdom', 'en-GB')">
                    <rect width="60" height="40" fill="#012169"/>
                    <path d="M0,0 L60,40 M60,0 L0,40" stroke="white" stroke-width="6"/>
                    <path d="M0,0 L60,40 M60,0 L0,40" stroke="#C8102E" stroke-width="2"/>
                    <path d="M30,0 V40 M0,20 H60" stroke="white" stroke-width="10"/>
                    <path d="M30,0 V40 M0,20 H60" stroke="#C8102E" stroke-width="6"/>
                </svg>
                <!-- Spain -->
                <svg class="flag-icon" viewBox="0 0 60 40" onclick="speakNative('España', 'es-ES')">
                    <rect width="60" height="40" fill="#AA151B"/>
                    <rect y="10" width="60" height="20" fill="#F1BF00"/>
                </svg>
                <!-- Germany -->
                <svg class="flag-icon" viewBox="0 0 60 40" onclick="speakNative('Deutschland', 'de-DE')">
                    <rect width="60" height="13.3" fill="black"/>
                    <rect y="13.3" width="60" height="13.3" fill="#DD0000"/>
                    <rect y="26.6" width="60" height="13.3" fill="#FFCE00"/>
                </svg>
                <!-- Austria -->
                <svg class="flag-icon" viewBox="0 0 60 40" onclick="speakNative('Österreich', 'de-DE')">
                    <rect width="60" height="40" fill="#ED2939"/>
                    <rect y="13.3" width="60" height="13.3" fill="white"/>
                </svg>
                <!-- Switzerland -->
                <svg class="flag-icon" viewBox="0 0 40 40" onclick="speakNative('Suisse', 'fr-CH')">
                    <rect width="40" height="40" fill="#D52B1E"/>
                    <rect x="13" y="6" width="14" height="28" fill="white"/>
                    <rect x="6" y="13" width="28" height="14" fill="white"/>
                </svg>
                <!-- Hungary -->
                <svg class="flag-icon" viewBox="0 0 60 40" onclick="speakNative('Magyarország', 'hu-HU')">
                    <rect width="60" height="13.3" fill="#436F4D"/>
                    <rect y="13.3" width="60" height="13.3" fill="white"/>
                    <rect y="26.6" width="60" height="13.3" fill="#CD2A3E"/>
                </svg>
                <!-- Portugal -->
                <svg class="flag-icon" viewBox="0 0 60 40" onclick="speakNative('Portugal', 'pt-PT')">
                    <rect width="24" height="40" fill="#046A38"/>
                    <rect x="24" width="36" height="40" fill="#DA291C"/>
                    <circle cx="24" cy="20" r="8" fill="#FFD700"/>
                </svg>
            </div>
        </div>
        <div class="scroll-indicator" onclick="scrollToId('intro')">
            <i class="fas fa-chevron-down"></i>
        </div>
    </header>

    <main>
        <!-- Intro -->
        <section id="intro" class="visible">
            <div class="section-header">
                <span class="section-number">00</span>
                <h2 class="section-title">Introduction</h2>
            </div>
            <div class="intro-text">
                <p>Bonjour, Mon Ami.</p>
                <p>私たちは今、フランスという偉大なる基準点を背に、未知なる可能性の海へと漕ぎ出します。ピレネー山脈の向こうにある情熱の台地、ライン川の切り立った急斜面、そしてドナウ川の優雅なせせらぎ。</p>
                <p>スペイン、ドイツ、オーストリア、スイス、ハンガリー、そしてポルトガル。これらの国のワイン造りは、極限の環境との戦いであり、歴史との対話です。ここでは「標準」は通用しません。あるのは、その土地独自の生存戦略としての「スタイル」のみ。</p>
                <p>色彩を取り戻した、私の動的図鑑（Dynamic Atlas）を開きましょう。</p>
            </div>
        </section>

        <!-- Interactive Map -->
        <section id="atlas">
            <div class="section-header">
                <span class="section-number">01</span>
                <h2 class="section-title">The European Dynamic Atlas</h2>
            </div>
            <div class="map-wrapper">
                <div class="map-container" id="mapContainer">
                    <svg class="europe-map" id="interactiveMap" viewBox="0 0 1000 800" preserveAspectRatio="xMidYMid meet">
                        <!-- UK -->
                        <path class="map-region" id="region-uk" d="M300,100 L360,90 L380,160 L340,190 L270,160 Z" onclick="scrollToId('others'); setChapterColor('others')"/>
                        <text x="330" y="140" class="map-label">UK</text>
                        <!-- Spain -->
                        <path class="map-region" id="region-spain" d="M120,450 L250,430 L280,500 L250,620 L120,580 L90,500 Z" onclick="scrollToId('spain'); setChapterColor('spain')"/>
                        <text x="190" y="520" class="map-label" style="font-size: 22px;">SPAIN</text>
                        <!-- Portugal -->
                        <path class="map-region" id="region-portugal" d="M90,500 L120,450 L120,580 L70,550 Z" onclick="scrollToId('portugal'); setChapterColor('portugal')"/>
                        <text x="95" y="530" class="map-label" style="font-size: 12px;">PRT</text>
                        <!-- France -->
                        <path d="M250,430 L380,330 L430,380 L420,530 L280,500 Z" fill="#F4F6F7" stroke="#BDC3C7" stroke-dasharray="3,3"/>
                        <text x="350" y="440" class="map-label" style="opacity:0.3; font-size: 20px;">FRANCE</text>
                        <!-- Germany -->
                        <path class="map-region" id="region-germany" d="M430,280 L500,250 L560,260 L550,350 L430,350 Z" onclick="scrollToId('germany'); setChapterColor('germany')"/>
                        <text x="490" y="310" class="map-label" style="font-size: 20px;">GERMANY</text>
                        <!-- Austria -->
                        <path class="map-region" id="region-austria" d="M550,350 L640,330 L670,380 L590,400 L560,370 Z" onclick="scrollToId('austria'); setChapterColor('austria')"/>
                        <text x="610" y="370" class="map-label" style="font-size: 18px;">AUSTRIA</text>
                        <!-- Switzerland -->
                        <path class="map-region" id="region-swiss" d="M430,380 L480,380 L490,400 L460,430 L420,420 Z" onclick="scrollToId('swiss'); setChapterColor('swiss')"/>
                        <text x="455" y="410" class="map-label" style="font-size: 14px;">CH</text>
                        <!-- Hungary -->
                        <path class="map-region" id="region-hungary" d="M640,330 L740,320 L760,400 L670,420 L670,380 Z" onclick="scrollToId('hungary'); setChapterColor('hungary')"/>
                        <text x="700" y="370" class="map-label" style="font-size: 16px;">HUNGARY</text>
                        <!-- Italy -->
                        <path d="M460,430 L530,430 L580,600 L500,650 L460,500 Z" fill="#F4F6F7" stroke="#BDC3C7" stroke-dasharray="2,2"/>
                    </svg>
                    
                    <div class="map-controls" onpointerdown="event.stopPropagation()">
                        <div class="map-btn" onclick="zoomMap(0.8)"><i class="fas fa-plus"></i></div>
                        <div class="map-btn" onclick="zoomMap(1.25)"><i class="fas fa-minus"></i></div>
                    </div>
                </div>
                <div class="map-list">
                    <div class="map-list-item spain" onclick="scrollToId('spain'); setChapterColor('spain')"><span><i class="fas fa-flag"></i> Spain</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="map-list-item germany" onclick="scrollToId('germany'); setChapterColor('germany')"><span><i class="fas fa-flag"></i> Germany</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="map-list-item austria" onclick="scrollToId('austria'); setChapterColor('austria')"><span><i class="fas fa-flag"></i> Austria</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="map-list-item swiss" onclick="scrollToId('swiss'); setChapterColor('swiss')"><span><i class="fas fa-flag"></i> Switzerland</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="map-list-item hungary" onclick="scrollToId('hungary'); setChapterColor('hungary')"><span><i class="fas fa-flag"></i> Hungary</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="map-list-item portugal" onclick="scrollToId('portugal'); setChapterColor('portugal')"><span><i class="fas fa-flag"></i> Portugal</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="map-list-item others" onclick="scrollToId('others'); setChapterColor('others')"><span><i class="fas fa-globe-europe"></i> UK & Others</span> <i class="fas fa-chevron-right"></i></div>
                </div>
            </div>
            <p class="map-instruction">地図をスワイプして移動、またはリストから選んで旅を始めましょう。</p>
        </section>

        <!-- Spain Chapter -->
        <section id="spain" data-color="#C0392B">
            <div class="section-header">
                <span class="section-number">02</span>
                <h2 class="section-title">Spain: Sleeping Giant</h2>
                <button class="audio-btn" onclick="speakNative('España', 'es-ES')"><i class="fas fa-volume-up"></i></button>
            </div>

            <div class="region-detail-block">
                <div class="region-text">
                    <h3><span class="glossary-term" onclick="openGlossary('Rioja')">Rioja</span> (リオハ) <button class="audio-btn" onclick="speakNative('Rioja', 'es-ES')"><i class="fas fa-volume-up"></i></button></h3>
                    <p>エブロ川流域に広がるスペインワインの心臓部。19世紀後半、フィロキセラ禍から逃れたボルドーの生産者たちが技術を持ち込んだことで品質が飛躍しました。伝統的にはアメリカンオーク樽での長期熟成（<span class="glossary-term" onclick="openGlossary('Reserva')">Reserva</span>, <span class="glossary-term" onclick="openGlossary('Gran Reserva')">Gran Reserva</span>）を行い、バニラやココナッツの甘美な香りを纏わせるスタイルが特徴ですが、現在はテロワール重視の動きも活発です。</p>
                    <h4>Three Sub-regions</h4>
                    <p>
                        <strong><span class="glossary-term" onclick="openGlossary('Rioja Alta')">Rioja Alta</span>:</strong> 鉄分を含む粘土質と沖積土壌。酸が高く、エレガントで長期熟成向き。<br>
                        <strong><span class="glossary-term" onclick="openGlossary('Rioja Alavesa')">Rioja Alavesa</span>:</strong> バスク地方側。粘土石灰質。果実味豊かで繊細、最も軽いスタイル。<br>
                        <strong><span class="glossary-term" onclick="openGlossary('Rioja Oriental')">Rioja Oriental</span>:</strong> 地中海性気候の影響が強く、暑くて乾燥している。アルコール度数が高く、ボディのあるガルナッチャ主体のワインが多い。
                    </p>
                </div>
                <div class="region-highlights">
                    <h4>Aging Requirements (Red)</h4>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Crianza')">Crianza</span>:</strong> 最低24ヶ月熟成（うち樽6ヶ月以上）。</div>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Reserva')">Reserva</span>:</strong> 最低36ヶ月熟成（うち樽12ヶ月以上）。</div>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Gran Reserva')">Gran Reserva</span>:</strong> 最低60ヶ月熟成（うち樽18ヶ月以上）。</div>
                </div>
            </div>

             <div class="region-detail-block">
                <div class="region-text">
                    <h3>Ribera del Duero & Priorat</h3>
                    <p><strong><span class="glossary-term" onclick="openGlossary('Ribera del Duero')">Ribera del Duero</span>:</strong> 標高700〜1000mの過酷なメセタ（台地）。寒暖差が激しく、ブドウの果皮が厚くなり、インクのように濃く力強いタンニンのワインが生まれます。</p>
                    <p><strong><span class="glossary-term" onclick="openGlossary('Priorat')">Priorat</span> (プリオラート):</strong> カタルーニャ州の険しい山岳地帯。最大の特徴は<span class="glossary-term" onclick="openGlossary('Llicorella')">Llicorella</span>（粘板岩）土壌。鋼のようなミネラルと驚異的な凝縮感を持つ赤ワインの聖地です。</p>
                </div>
            </div>

            <div class="region-detail-block">
                <div class="region-text">
                    <h3>Jerez (Sherry) <button class="audio-btn" onclick="speakNative('Jerez', 'es-ES')"><i class="fas fa-volume-up"></i></button></h3>
                    <p>アンダルシアの酒精強化ワイン。熟成中の樽に<span class="glossary-term" onclick="openGlossary('Flor')">Flor</span>（フロール）という産膜酵母の膜が張ることで、ワインは酸化から守られ独特の風味を得ます。「ソレラ・システム」により、品質とスタイルを永遠に維持します。</p>
                </div>
                <div class="region-highlights">
                    <h4>Styles of Sherry</h4>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Fino')">Fino</span> / <span class="glossary-term" onclick="openGlossary('Manzanilla')">Manzanilla</span>:</strong> フロールの下で熟成。辛口、酵母の香り。</div>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Amontillado')">Amontillado</span>:</strong> フィノの途中でフロールが消失し、酸化熟成へ移行したもの。</div>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Oloroso')">Oloroso</span>:</strong> 最初から酸化熟成させた、濃い琥珀色のフルボディ。</div>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Palo Cortado')">Palo Cortado</span>:</strong> 希少タイプ。アモンティリャードの香りとオロロソのボディ。</div>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Pedro Ximénez')">Pedro Ximénez (PX)</span>:</strong> 干し葡萄から造る極甘口。黒蜜のような濃厚さ。</div>
                </div>
            </div>

            <h4 style="margin: 2rem 0 1rem; color: var(--color-spain); text-align:center;">Ampelography: Spain</h4>
            <div class="grape-grid">
                <div class="grape-card red">
                    <div class="grape-name">
                        Tempranillo <button class="audio-btn" onclick="speakNative('Tempranillo', 'es-ES')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="grape-desc">スペインの絶対王者。「早熟(Temprano)」に由来。苺、プラム、タバコ。</div>
                    <div class="stat-row"><span class="stat-label">Body</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 80%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Tannin</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 75%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Acid</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 60%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Alcohol</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 70%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Aroma</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 80%"></div></div></div>
                </div>
                <div class="grape-card red">
                    <div class="grape-name">
                        Garnacha <button class="audio-btn" onclick="speakNative('Garnacha', 'es-ES')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="grape-desc">地中海の太陽。高アルコール、赤い果実、スパイス。</div>
                    <div class="stat-row"><span class="stat-label">Body</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 90%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Tannin</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 50%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Acid</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 40%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Alcohol</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 95%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Aroma</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 85%"></div></div></div>
                </div>
                <div class="grape-card white">
                    <div class="grape-name">
                        Albariño <button class="audio-btn" onclick="speakNative('Albariño', 'es-ES')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="grape-desc">「海のワイン」。リアス・バイシャス原産。桃と塩気。</div>
                    <div class="stat-row"><span class="stat-label">Body</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 60%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Tannin</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 10%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Acid</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 95%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Alcohol</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 65%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Aroma</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 90%"></div></div></div>
                </div>
            </div>
            <button class="back-to-map" onclick="scrollToId('atlas')">Back to Map</button>
        </section>

        <!-- Germany Chapter -->
        <section id="germany" data-color="#117864">
            <div class="section-header">
                <span class="section-number">03</span>
                <h2 class="section-title">Germany: Logic & Tension</h2>
                <button class="audio-btn" onclick="speakNative('Deutschland', 'de-DE')"><i class="fas fa-volume-up"></i></button>
            </div>
            
            <!-- Optimized Layout: Classification & Oechsle -->
            <div class="region-detail-block">
                <div class="region-text">
                    <h3>Classification & Oechsle</h3>
                    <p>ドイツワインの格付けは、収穫時の果汁糖度（エクスレ度）に基づきます。糖度が高いほど上級とされますが、現代では辛口（Trocken）も重要視され、VDP（生産者協会）によるブルゴーニュ的な畑の格付け（Grosse Lageなど）も普及しています。</p>
                    <ul style="margin-left: 1.5rem; color:#444;">
                        <li><strong><span class="glossary-term" onclick="openGlossary('Deutscher Wein')">Deutscher Wein</span>:</strong> テーブルワイン。国内産ブドウを使用。<button class="audio-btn" onclick="speakNative('Deutscher Wein', 'de-DE')"><i class="fas fa-volume-up"></i></button></li>
                        <li><strong><span class="glossary-term" onclick="openGlossary('Landwein')">Landwein</span>:</strong> 地酒。指定地域のブドウを85%以上使用。<button class="audio-btn" onclick="speakNative('Landwein', 'de-DE')"><i class="fas fa-volume-up"></i></button></li>
                        <li><strong><span class="glossary-term" onclick="openGlossary('Qualitätswein')">Qualitätswein</span>:</strong> 指定地域の高品質ワイン。補糖可能。<button class="audio-btn" onclick="speakNative('Qualitätswein', 'de-DE')"><i class="fas fa-volume-up"></i></button></li>
                        <li><strong><span class="glossary-term" onclick="openGlossary('Prädikatswein')">Prädikatswein</span>:</strong> 肩書き付き上級ワイン。補糖は一切禁止。<button class="audio-btn" onclick="speakNative('Prädikatswein', 'de-DE')"><i class="fas fa-volume-up"></i></button></li>
                    </ul>
                </div>
                <div class="region-highlights">
                    <h4>Prädikatswein Hierarchy</h4>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Kabinett')">Kabinett</span>:</strong> 最もライト。繊細な酸。</div>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Spätlese')">Spätlese</span>:</strong> 遅摘み。果実味豊か。</div>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Auslese')">Auslese</span>:</strong> 房選り。完熟。</div>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Beerenauslese')">Beerenauslese (BA)</span>:</strong> 粒選り。貴腐を含む。</div>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Eiswein')">Eiswein</span>:</strong> 凍結したブドウから造る。酸と甘みの奇跡。</div>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('TBA')">Trockenbeerenauslese (TBA)</span>:</strong> 干し葡萄状の貴腐粒。至宝。</div>
                </div>
            </div>

            <div class="region-detail-block">
                <div class="region-text">
                    <h3>Key Regions: Mosel & Rheingau</h3>
                    <p><strong><span class="glossary-term" onclick="openGlossary('Mosel')">Mosel</span>:</strong> スレート（粘板岩）の急斜面。繊細で低アルコール、フローラルなリースリング。</p>
                    <p><strong><span class="glossary-term" onclick="openGlossary('Rheingau')">Rheingau</span>:</strong> ライン川の反射光を受ける南斜面。力強く威厳のあるリースリング。</p>
                </div>
                <div class="region-highlights">
                    <h4>VDP Classification</h4>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Grosse Lage')">Grosse Lage</span>:</strong> 特級畑。最高のテロワール。</div>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Erste Lage')">Erste Lage</span>:</strong> 1級畑。</div>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Grosses Gewächs')">Grosses Gewächs (GG)</span>:</strong> 特級畑から造られる最上級の辛口ワイン。</div>
                </div>
            </div>

            <h4 style="margin: 2rem 0 1rem; color: var(--color-germany); text-align:center;">Ampelography: Germany</h4>
            <div class="grape-grid">
                <div class="grape-card white">
                    <div class="grape-name">
                        Riesling <button class="audio-btn" onclick="speakNative('Riesling', 'de-DE')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="grape-desc">高貴な白ブドウの代名詞。鋼のような酸と、地盤のミネラルを鏡のように映し出す能力を持つ。若い時は青リンゴ、ライム、白い花。熟成すると蜂蜜やTDN（ペトロール/灯油のような香り）という独特のブーケを発する。長期熟成能力は白ワイン随一。</div>
                    <div class="stat-row"><span class="stat-label">Body</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 40%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Tannin</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 5%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Acid</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 100%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Alcohol</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 40%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Aroma</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 95%"></div></div></div>
                </div>
                <div class="grape-card red">
                    <div class="grape-name">
                        Spätburgunder <button class="audio-btn" onclick="speakNative('Spätburgunder', 'de-DE')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="grape-desc">独産ピノ・ノワール。温暖化により品質が急上昇。</div>
                    <div class="stat-row"><span class="stat-label">Body</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 60%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Tannin</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 50%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Acid</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 80%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Alcohol</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 65%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Aroma</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 90%"></div></div></div>
                </div>
            </div>
            
            <button class="back-to-map" onclick="scrollToId('atlas')">Back to Map</button>
        </section>

        <!-- Austria Chapter -->
        <section id="austria" data-color="#F1C40F">
            <div class="section-header">
                <span class="section-number">04</span>
                <h2 class="section-title">Austria: The Phoenix from Ash</h2>
                <button class="audio-btn" onclick="speakNative('Österreich', 'de-DE')"><i class="fas fa-volume-up"></i></button>
            </div>
            
            <!-- Detail Block: Wachau -->
            <div class="region-detail-block">
                <div class="region-text">
                    <h3><span class="glossary-term" onclick="openGlossary('Wachau')">Wachau</span> (ヴァッハウ) <button class="audio-btn" onclick="speakNative('Wachau', 'de-DE')"><i class="fas fa-volume-up"></i></button></h3>
                    <p>ドナウ川渓谷の最も美しい文化的景観（世界遺産）。急斜面のテラス状の畑は、片麻岩（Gneiss）と黄土（Loess）で構成されています。ここでは独自の生産者組合「Vinea Wachau」が、一切の補糖を禁止する厳格な格付けを定めています。</p>
                    <p>特に「スマラクト（Smaragd）」は、完熟したブドウのみから造られるアルコール度数12.5%以上の最上級辛口ワインであり、畑に生息するエメラルド色のトカゲの名前に由来します。豊かなボディとフィネスを兼ね備えた、世界最高峰の白ワインの一つです。</p>
                </div>
                <div class="region-highlights">
                    <h4>Vinea Wachau Classification</h4>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Steinfeder')">Steinfeder</span>:</strong> 軽快でフレッシュ (max 11.5% alc)</div>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Federspiel')">Federspiel</span>:</strong> エレガントな中庸ボディ (11.5-12.5% alc)</div>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Smaragd')">Smaragd</span>:</strong> 複雑でリッチ、長期熟成型 (min 12.5% alc)</div>
                </div>
            </div>

             <!-- Detail Block: Burgenland & Styria -->
             <div class="region-detail-block">
                <div class="region-text">
                    <h3>Burgenland & Styria</h3>
                    <p><strong><span class="glossary-term" onclick="openGlossary('Burgenland')">Burgenland</span> (ブルゲンラント):</strong> ハンガリー国境近く。浅いノイジードル湖が湿気を生み、世界的な貴腐ワインの産地となっています。また、温暖な気候を生かしたブラウフレンキッシュなどの赤ワインも秀逸です。</p>
                    <p><strong><span class="glossary-term" onclick="openGlossary('Styria')">Styria</span> (シュタイヤーマルク):</strong> 南部の丘陵地帯。ソーヴィニヨン・ブランの隠れた名産地であり、鮮烈な酸と果実味を持つ「世界で最もクリーンなワイン」が造られます。</p>
                </div>
            </div>

            <!-- Ampelography Grid -->
            <h4 style="margin: 2rem 0 1rem; color: var(--color-austria); text-align:center;">Ampelography: Austria</h4>
            <div class="grape-grid">
                <div class="grape-card white">
                    <div class="grape-name">
                        Grüner Veltliner <button class="audio-btn" onclick="speakNative('Grüner Veltliner', 'de-DE')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="grape-desc">オーストリアの栽培面積の約3割を占める国民的品種。「Pfefferl（フェッフェル）」と呼ばれる白胡椒のようなスパイシーな香りが特徴。軽快なリンゴの風味を持つものから、ブルゴーニュのシャルドネのようにリッチでクリーミーなものまで、スタイルの幅が広い。</div>
                    <div class="stat-row"><span class="stat-label">Body</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 60%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Tannin</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 5%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Acid</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 80%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Alcohol</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 65%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Aroma</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 85%"></div></div></div>
                </div>
                <div class="grape-card red">
                    <div class="grape-name">
                        Zweigelt <button class="audio-btn" onclick="speakNative('Zweigelt', 'de-DE')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="grape-desc">フリッツ・ツヴァイゲルト博士がサン・ローランとブラウフレンキッシュを交配させて生み出した品種。紫がかった鮮やかな色調、チェリーの果実味、そして柔らかいタンニンを持つ。冷やしても美味しく、オーストリアの赤ワインの主力。</div>
                    <div class="stat-row"><span class="stat-label">Body</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 60%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Tannin</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 40%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Acid</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 70%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Alcohol</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 60%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Aroma</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 75%"></div></div></div>
                </div>
            </div>

            <button class="back-to-map" onclick="scrollToId('atlas')">Back to Map</button>
        </section>

        <!-- Switzerland (Expanded) -->
        <section id="swiss" data-color="#E74C3C">
            <div class="section-header">
                <span class="section-number">05</span>
                <h2 class="section-title">Switzerland: The Secret Garden</h2>
                <button class="audio-btn" onclick="speakNative('Suisse', 'fr-CH')"><i class="fas fa-volume-up"></i></button>
            </div>
            
            <div class="intro-text">
                <p>
                    「スイスワインの秘密はスイス人が知っている」。生産量のわずか2%未満しか輸出されないため、この国のワインは世界中の愛好家にとって幻の存在です。アルプスの急斜面、湖の反射光、そして複雑なモザイクのような土壌が生み出すのは、クリスタルのような純度を持つワインです。
                </p>
            </div>

            <!-- Detail Block: Valais -->
            <div class="region-detail-block">
                <div class="region-text">
                    <h3><span class="glossary-term" onclick="openGlossary('Valais')">Valais</span> (ヴァレー) <button class="audio-btn" onclick="speakNative('Valais', 'fr-CH')"><i class="fas fa-volume-up"></i></button></h3>
                    <p>ローヌ川上流の谷間。周囲を4000m級の山々に囲まれ、フェーン現象により乾燥した温暖な気候を持ちます。スイス最大の産地であり、土着品種の宝庫です。ここでは、プティット・アルヴィンやコルナランといった独自の品種から、力強い赤ワインや遅摘みの甘口ワインまで、多様なスタイルが造られます。</p>
                    <p><strong><span class="glossary-term" onclick="openGlossary('Fendant')">Fendant</span> (ファンダン):</strong> ヴァレー州でのシャスラの呼び名。フレッシュで発泡性をわずかに残すこともあり、食前酒やラクレットの最高の友となります。</p>
                </div>
                <div class="region-highlights">
                    <h4>Key Facts</h4>
                    <div class="highlight-item"><strong>Climate:</strong> Alpine & Sunny (年間降水量少ない)</div>
                    <div class="highlight-item"><strong>Grape:</strong> Petite Arvine, Cornalin (土着品種)</div>
                    <div class="highlight-item"><strong>Icon:</strong> Highest Vineyard in Europe (Visperterminen)</div>
                </div>
            </div>

            <!-- Detail Block: Vaud -->
            <div class="region-detail-block">
                <div class="region-text">
                    <h3><span class="glossary-term" onclick="openGlossary('Vaud')">Vaud</span> (ヴォー) <button class="audio-btn" onclick="speakNative('Vaud', 'fr-CH')"><i class="fas fa-volume-up"></i></button></h3>
                    <p>レマン湖の北岸に広がる、シャスラの聖地。特に「Lavaux（ラヴォー）」地区の段々畑は世界遺産に登録されています。ここでは「3つの太陽」がブドウを熟させると言われます。</p>
                    <ol style="margin-left:1.5rem; margin-bottom:1rem; color:#555;">
                        <li><strong>直射日光:</strong> 空からの太陽。</li>
                        <li><strong>反射光:</strong> レマン湖面からの照り返し。</li>
                        <li><strong>輻射熱:</strong> 石垣が昼間に蓄えた熱。</li>
                    </ol>
                    <p>この環境が、シャスラにリッチな果実味と、鋼のようなミネラルを与えます。</p>
                </div>
                <div class="region-highlights">
                    <h4>Key Facts</h4>
                    <div class="highlight-item"><strong>Terroir:</strong> Lake Geneva (Léman) Influence</div>
                    <div class="highlight-item"><strong>Grape:</strong> Chasselas (King of Vaud)</div>
                    <div class="highlight-item"><strong>Style:</strong> Mineral, Delicate, Floral</div>
                </div>
            </div>

             <!-- Ampelography Grid -->
            <h4 style="margin: 2rem 0 1rem; color: var(--color-swiss); text-align:center;">Ampelography: Switzerland</h4>
            <div class="grape-grid">
                <div class="grape-card white">
                    <div class="grape-name">
                        Chasselas <button class="audio-btn" onclick="speakNative('Chasselas', 'fr-CH')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="grape-desc">スイスの白ワインの王。非常にニュートラルな品種ゆえに、土壌の個性を鏡のように映し出す「テロワールの翻訳者」。白い花、ハーブ、そして熟成により蜂蜜やトーストの香りを持つ。微発泡を感じることもあり、アペリティフからチーズフォンデュまで万能。</div>
                    <div class="stat-row"><span class="stat-label">Body</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 40%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Tannin</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 5%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Acid</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 50%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Alcohol</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 55%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Aroma</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 60%"></div></div></div>
                </div>
                <div class="grape-card red">
                    <div class="grape-name">
                        Pinot Noir <button class="audio-btn" onclick="speakNative('Pinot Noir', 'fr-CH')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="grape-desc">スイスで最も栽培されている黒ブドウ。特にグラウビュンデン州やヌーシャテル州で高品質なものが造られる。冷涼な気候を生かした、エレガントで赤いベリーの香りが際立つスタイルが主流。</div>
                    <div class="stat-row"><span class="stat-label">Body</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 50%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Tannin</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 40%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Acid</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 75%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Alcohol</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 60%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Aroma</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 85%"></div></div></div>
                </div>
            </div>

            <button class="back-to-map" onclick="scrollToId('atlas')">Back to Map</button>
        </section>

        <!-- Hungary Chapter -->
        <section id="hungary" data-color="#D35400">
            <div class="section-header">
                <span class="section-number">06</span>
                <h2 class="section-title">Hungary: The Royal Legend</h2>
                <button class="audio-btn" onclick="speakNative('Magyarország', 'hu-HU')"><i class="fas fa-volume-up"></i></button>
            </div>

            <!-- Detail Block: Tokaj -->
            <div class="region-detail-block">
                <div class="region-text">
                    <h3><span class="glossary-term" onclick="openGlossary('Tokaj')">Tokaj</span> (トカイ) <button class="audio-btn" onclick="speakNative('Tokaj', 'hu-HU')"><i class="fas fa-volume-up"></i></button></h3>
                    <p>世界三大貴腐ワインの一つ「トカイ・アスー」の故郷。この地では1737年に世界で初めてブドウ畑の格付けが行われました。カルパティア山脈が寒風を防ぎ、ボドログ川とティサ川の合流地点から発生する霧が、秋のブドウに<span class="glossary-term" onclick="openGlossary('Botrytis')">貴腐菌</span>をもたらします。</p>
                    <h4>The Aszú Process</h4>
                    <p>独特の製法は、貴腐化した干し葡萄状の粒（Aszú）を一粒ずつ手摘みし、それを搾ったペーストを、通常の白ワイン（ベースワイン）の樽（Gönci）に漬け込むというもの。このAszúの量（<span class="glossary-term" onclick="openGlossary('Puttonyos')">Puttonyos</span>という背負い籠の数）で甘さが決まります。</p>
                </div>
                <div class="region-highlights">
                    <h4>Key Terms</h4>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Aszú')">Aszú</span>:</strong> 貴腐ブドウ。</div>
                    <div class="highlight-item"><strong>Puttonyos:</strong> 糖度の単位（3〜6）。</div>
                    <div class="highlight-item"><strong><span class="glossary-term" onclick="openGlossary('Essencia')">Essencia</span>:</strong> 貴腐ブドウの自重だけで滴り落ちるフリーランジュース。糖度は450g/Lを超え、発酵に数年かかることもある。</div>
                </div>
            </div>

            <!-- Detail Block: Eger -->
            <div class="region-detail-block">
                <div class="region-text">
                    <h3><span class="glossary-term" onclick="openGlossary('Eger')">Eger</span> (エゲル) <button class="audio-btn" onclick="speakNative('Eger', 'hu-HU')"><i class="fas fa-volume-up"></i></button></h3>
                    <p>北部ハンガリーの歴史的産地。有名な「<span class="glossary-term" onclick="openGlossary('Egri Bikavér')">Egri Bikavér</span>（雄牛の血）」は、1552年のオスマン帝国軍との戦いで、ハンガリーの兵士たちが赤ワインを飲んで髭を赤く染め、敵に「彼らは雄牛の血を飲んで力を得ている」と恐れられた伝説に由来します。ケークフランコシュ主体で、最低3品種以上をブレンドし、オーク樽で熟成させる力強い赤ワインです。</p>
                </div>
                <div class="region-highlights">
                    <h4>Egri Bikavér</h4>
                    <div class="highlight-item"><strong>Grape:</strong> Kékfrankos (main), Kadarka, Merlot etc.</div>
                    <div class="highlight-item"><strong>Style:</strong> スパイシー、土の香り、フルボディ。</div>
                </div>
            </div>

            <!-- Ampelography Grid -->
            <h4 style="margin: 2rem 0 1rem; color: var(--color-hungary); text-align:center;">Ampelography: Hungary</h4>
            <div class="grape-grid">
                <div class="grape-card white">
                    <div class="grape-name">
                        Furmint <button class="audio-btn" onclick="speakNative('Furmint', 'hu-HU')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="grape-desc">トカイの魂であり、世界で最も偉大な白ブドウの一つ。晩熟で酸が極めて高く、果皮が薄いため貴腐菌が付きやすい。辛口に仕立てると、火打石のようなミネラルと鋭い酸、そして洋梨やライムの香りを持つ、長期熟成型のワインとなる。</div>
                    <div class="stat-row"><span class="stat-label">Body</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 70%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Tannin</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 5%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Acid</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 100%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Alcohol</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 75%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Aroma</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 85%"></div></div></div>
                </div>
                <div class="grape-card white">
                    <div class="grape-name">
                        Hárslevelű <button class="audio-btn" onclick="speakNative('Hárslevelű', 'hu-HU')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="grape-desc">「菩提樹（リンデン）の葉」を意味する。フルミントのパートナーとしてブレンドされることが多いが、単一品種としても魅力的。フルミントより酸は穏やかで、よりアロマティック。蜂蜜、リンデンの花、スパイスの香りが特徴で、ワインにまろやかさを与える。</div>
                    <div class="stat-row"><span class="stat-label">Body</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 60%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Tannin</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 5%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Acid</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 60%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Alcohol</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 65%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Aroma</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 90%"></div></div></div>
                </div>
            </div>

            <button class="back-to-map" onclick="scrollToId('atlas')">Back to Map</button>
        </section>

        <!-- Portugal Chapter (New Expanded) -->
        <section id="portugal" data-color="#2E86C1">
            <div class="section-header">
                <span class="section-number">07</span>
                <h2 class="section-title">Portugal: Atlantic Soul</h2>
                <button class="audio-btn" onclick="speakNative('Portugal', 'pt-PT')"><i class="fas fa-volume-up"></i></button>
            </div>
            
            <div class="region-detail-block">
                <div class="region-text">
                    <h3><span class="glossary-term" onclick="openGlossary('Port')">Port</span> (ポート) <button class="audio-btn" onclick="speakNative('Vinho do Porto', 'pt-PT')"><i class="fas fa-volume-up"></i></button></h3>
                    <p>ドウロ渓谷の急斜面で造られる世界的な酒精強化ワイン。発酵途中でブランデーを添加し、甘みを残します。
                    <br><strong><span class="glossary-term" onclick="openGlossary('Ruby Port')">Ruby</span>:</strong> 鮮やかな赤色、果実味重視。
                    <br><strong><span class="glossary-term" onclick="openGlossary('Tawny Port')">Tawny</span>:</strong> 樽熟成により琥珀色に変化。ナッツやキャラメルの香り。
                    <br><strong><span class="glossary-term" onclick="openGlossary('Vintage Port')">Vintage</span>:</strong> 最良の年のみ。瓶内で数十年熟成。</p>

                    <h3><span class="glossary-term" onclick="openGlossary('Madeira')">Madeira</span> (マデイラ) <button class="audio-btn" onclick="speakNative('Madeira', 'pt-PT')"><i class="fas fa-volume-up"></i></button></h3>
                    <p>大西洋の孤島で造られる、「不死のワイン」。加熱熟成（Estufagem）により、独特の焼き菓子のような風味と、開栓後も劣化しない驚異的な保存性を持ちます。</p>
                </div>
                <div class="region-highlights">
                    <h4>Key Regions</h4>
                    <div class="highlight-item"><strong>Douro:</strong> ポートと高品質な赤ワイン。</div>
                    <div class="highlight-item"><strong>Vinho Verde:</strong> 「緑のワイン」。微発泡でフレッシュ。</div>
                </div>
            </div>
            <h4 style="margin: 2rem 0 1rem; color: var(--color-portugal); text-align:center;">Ampelography: Portugal</h4>
            <div class="grape-grid">
                <div class="grape-card red">
                    <div class="grape-name">
                        Touriga Nacional <button class="audio-btn" onclick="speakNative('Touriga Nacional', 'pt-PT')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="grape-desc">ポルトガルの至宝。スミレ、ベルガモット、アールグレイティーのような華やかな香りを持つ。ポートワインの主役であり、スティルワインとしても凝縮感とエレガンスを兼ね備えた偉大なワインを生む。</div>
                    <div class="stat-row"><span class="stat-label">Body</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 90%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Tannin</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 85%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Acid</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 70%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Alcohol</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 80%"></div></div></div>
                    <div class="stat-row"><span class="stat-label">Aroma</span><div class="stat-bar-bg"><div class="stat-bar-fill" style="width: 95%"></div></div></div>
                </div>
            </div>
            <button class="back-to-map" onclick="scrollToId('atlas')">Back to Map</button>
        </section>

        <!-- Others Chapter -->
        <section id="others" data-color="#8E44AD">
            <div class="section-header">
                <span class="section-number">08</span>
                <h2 class="section-title">New Frontiers: UK</h2>
            </div>
            
            <!-- UK -->
            <div class="region-detail-block">
                <div class="region-text">
                    <h3>United Kingdom <button class="audio-btn" onclick="speakNative('United Kingdom', 'en-GB')"><i class="fas fa-volume-up"></i></button></h3>
                    <p>かつてはワイン不毛の地と言われましたが、気候変動により南部のサセックスやケントは、海を挟んでシャンパーニュ地方と地続きの<span class="glossary-term" onclick="openGlossary('Chalk')">チョーク土壌</span>を持つ世界最高のスパークリングワイン産地へと変貌しました。高い酸と純粋な果実味を持つ英国のスパークリングは、ブラインド・テイスティングで本家シャンパーニュを凌駕することも珍しくありません。</p>
                    <p>歴史的に見ると、英国はボルドーワイン（クラレット）やポートワインの最大の擁護者であり、消費市場としてワイン世界の発展を牽引してきました。また、ガラス瓶の強化技術の開発など、シャンパーニュの誕生にも深く関与しています。</p>
                </div>
                <div class="region-highlights">
                    <h4>Key Facts</h4>
                    <div class="highlight-item"><strong>Soil:</strong> Kimmeridgian Chalk (白亜質)</div>
                    <div class="highlight-item"><strong>Style:</strong> Sparkling (Traditional Method)</div>
                </div>
            </div>

            <button class="back-to-map" onclick="scrollToId('atlas')">Back to Map</button>
        </section>

        <!-- Chronicles of Vin (History) -->
        <section id="history" data-color="#C0392B">
            <div class="section-header">
                <span class="section-number">09</span>
                <h2 class="section-title">Chronicles of Vin</h2>
            </div>
            <div class="timeline-container">
                <div class="timeline-line"></div>
                <div class="timeline-event">
                    <div class="timeline-year">276 AD</div>
                    <div class="timeline-title">ローマ皇帝プロブス</div>
                    <p>軍隊を用いてライン川流域（ドイツ）やパンノニア（ハンガリー）にブドウを植樹させ、北方のワイン造りの礎を築く。</p>
                </div>
                <div class="timeline-event">
                    <div class="timeline-year">1737</div>
                    <div class="timeline-title">トカイの格付け制定</div>
                    <p>ハンガリー国王カール3世がトカイの畑を格付け。これはボルドーの格付け（1855年）より1世紀以上も早い、世界初の原産地呼称制度の原型。</p>
                </div>
                <div class="timeline-event">
                    <div class="timeline-year">1860s</div>
                    <div class="timeline-title">フィロキセラの悲劇</div>
                    <p>アメリカから持ち込まれた害虫により欧州のブドウ畑が壊滅。リオハへボルドーの生産者が移住し、醸造技術が飛躍的に向上する契機ともなった。</p>
                </div>
                <div class="timeline-event">
                    <div class="timeline-year">1985</div>
                    <div class="timeline-title">オーストリアの転換点</div>
                    <p>ジエチレングリコール混入事件が発生。この危機を契機に世界で最も厳しいワイン法を制定し、高品質な辛口白ワインの国へと劇的な復活を遂げる。</p>
                </div>
            </div>
        </section>

        <!-- Quiz Section -->
        <section id="quiz">
            <div class="section-header">
                <span class="section-number">FINAL</span>
                <h2 class="section-title">The Validation</h2>
            </div>
            <div class="quiz-container">
                <div id="quiz-intro" class="quiz-intro">
                    <p id="quiz-intro-text">
                        100問のプールから25問。合格ラインは80%。<br>
                        この中には、本編で語られなかった「未知の事実」も含まれています。<br>
                        不正解を恐れてはいけません。それは新たな発見への招待状であり、<br>
                        あなたの好奇心を刺激する学びのプロセスなのですから。<br>
                        さあ、あなたの知性と直感を、私に見せてください。
                    </p>
                    <button class="back-to-map" style="background:var(--gold-accent); color:white; border:none;" onclick="startQuiz()">Start Validation</button>
                </div>
                <div id="quiz-area" style="display:none;">
                    <div id="question-card-container"></div>
                </div>
                <div id="quiz-result" style="display:none; text-align:center;">
                    <h3 style="font-size:2rem;">Completed</h3>
                    <p id="score-display" style="font-size:1.5rem;"></p>
                    <button class="back-to-map" onclick="location.reload()">Return</button>
                </div>
            </div>
        </section>

    </main>

    <!-- Modal for Glossary & Pairing (Fixed ID for Header) -->
    <dialog id="glossary-modal">
        <div class="modal-header" id="modal-header">
            <h3 id="modal-title" style="margin:0;">Term</h3>
            <button class="modal-close" onclick="closeGlossary()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="modal-audio-controls" style="margin-bottom:1rem; display:flex; align-items:center;">
                <button class="audio-btn" style="background:#ddd; color:#333;" onclick="playCurrentTermAudio()"><i class="fas fa-volume-up"></i></button>
            </div>
            <p id="modal-desc">Description goes here.</p>
        </div>
    </dialog>
    
    <!-- Modal for Quiz Feedback -->
    <dialog id="quiz-feedback-modal">
        <div class="modal-header" id="quiz-feedback-header">
            <h3 id="quiz-feedback-title" style="margin:0;">Result</h3>
            <button class="modal-close" onclick="document.getElementById('quiz-feedback-modal').close()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="quiz-feedback-content"></div>
            <div id="quiz-next-btn-container" style="text-align:center; margin-top:1rem;"></div>
        </div>
    </dialog>

    <script>
        // --- State Management ---
        let currentChapterColor = getComputedStyle(document.documentElement).getPropertyValue('--chapter-color');

        // --- Interactive Map Logic ---
        const mapSvg = document.getElementById('interactiveMap');
        const mapContainer = document.getElementById('mapContainer');
        let isPanning = false;
        let startX, startY;
        let isDragging = false;
        let viewBox = { x: 50, y: 50, w: 900, h: 720 };

        function setViewBox() {
            mapSvg.setAttribute('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.w} ${viewBox.h}`);
        }

        mapContainer.addEventListener('pointerdown', (e) => {
            isPanning = true;
            isDragging = false;
            startX = e.clientX;
            startY = e.clientY;
            mapContainer.style.cursor = 'grabbing';
            mapContainer.setPointerCapture(e.pointerId);
        });

        mapContainer.addEventListener('pointermove', (e) => {
            if (!isPanning) return;
            
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;

            if (Math.abs(dx) > 5 || Math.abs(dy) > 5) {
                isDragging = true;
            }

            if(isDragging) {
                e.preventDefault();
                const scaleX = viewBox.w / mapContainer.clientWidth;
                const scaleY = viewBox.h / mapContainer.clientHeight;
                viewBox.x -= dx * scaleX;
                viewBox.y -= dy * scaleY;
                setViewBox();
                startX = e.clientX;
                startY = e.clientY;
            }
        });

        mapContainer.addEventListener('pointerup', (e) => {
            isPanning = false;
            mapContainer.style.cursor = 'grab';
            mapContainer.releasePointerCapture(e.pointerId);
        });
        
        mapContainer.addEventListener('click', (e) => {
            if(isDragging) {
                e.stopPropagation();
                e.preventDefault();
            }
        }, true);

        // Zoom Logic with StopPropagation Fix
        function zoomMap(factor) {
            const newW = viewBox.w * factor;
            const newH = viewBox.h * factor;
            viewBox.x += (viewBox.w - newW) / 2;
            viewBox.y += (viewBox.h - newH) / 2;
            viewBox.w = newW; viewBox.h = newH;
            setViewBox();
        }

        // --- Navigation ---
        function scrollToId(id) {
            const element = document.getElementById(id);
            if(element) element.scrollIntoView({ behavior: 'smooth' });
        }

        function setChapterColor(chapter) {
            const root = document.documentElement;
            let color = '#C5A059'; 
            if (chapter === 'spain') color = '#C0392B';
            if (chapter === 'germany') color = '#117864';
            if (chapter === 'austria') color = '#F1C40F';
            if (chapter === 'swiss') color = '#E74C3C';
            if (chapter === 'hungary') color = '#D35400';
            if (chapter === 'portugal') color = '#2E86C1';
            if (chapter === 'others') color = '#8E44AD';
            root.style.setProperty('--chapter-color', color);
            currentChapterColor = color;
            document.querySelectorAll('.back-to-map').forEach(el => {
                el.style.borderColor = color; el.style.color = color;
                el.onmouseenter = () => { el.style.background = color; el.style.color = 'white'; };
                el.onmouseleave = () => { el.style.background = 'transparent'; el.style.color = color; };
            });
            // Update background tint
            document.body.style.backgroundColor = hexToRgba(color, 0.08);
        }
        
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        const sections = document.querySelectorAll('section, header');
        const navDots = document.querySelectorAll('.nav-dot');
        window.addEventListener('scroll', () => {
            let current = '';
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById('progressBar').style.width = scrolled + "%";

            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (pageYOffset >= (sectionTop - section.clientHeight / 3)) {
                    current = section.getAttribute('id');
                    section.classList.add('visible');
                    // Trigger color change on scroll
                    const colorAttr = section.dataset.color;
                    if(colorAttr) {
                        const root = document.documentElement;
                        root.style.setProperty('--chapter-color', colorAttr);
                        document.body.style.backgroundColor = hexToRgba(colorAttr, 0.08);
                        
                        document.querySelectorAll('.back-to-map').forEach(el => {
                            el.style.borderColor = colorAttr; el.style.color = colorAttr;
                            el.onmouseenter = () => { el.style.background = colorAttr; el.style.color = 'white'; };
                            el.onmouseleave = () => { el.style.background = 'transparent'; el.style.color = colorAttr; };
                        });
                    }
                }
            });
            navDots.forEach(dot => {
                dot.classList.remove('active');
                if (dot.getAttribute('onclick').includes(current)) dot.classList.add('active');
            });
        });

        // --- Glossary Data ---
        const glossaryData = {
            'TBA': { text: "Trockenbeerenauslese (トロッケンベーレンアウスレーゼ)。貴腐ワインの最高峰。", lang: 'de-DE' },
            'Eiswein': { text: "Eiswein (アイスヴァイン)。凍結したブドウから造られる極甘口ワイン。", lang: 'de-DE' },
            'Beerenauslese': { text: "Beerenauslese (ベーレンアウスレーゼ)。粒選りの貴腐ワイン。", lang: 'de-DE' },
            'Oechsle': { text: "Oechsle (エクスレ)。ドイツにおける果汁糖度（比重）の単位。", lang: 'de-DE' },
            'Kabinett': { text: "Kabinett (カビネット)。最も軽やかなプレディカーツヴァイン。", lang: 'de-DE' },
            'Spätlese': { text: "Spätlese (シュペートレーゼ)。遅摘み。", lang: 'de-DE' },
            'Auslese': { text: "Auslese (アウスレーゼ)。房選り。", lang: 'de-DE' },
            'Deutscher Wein': { text: "Deutscher Wein (ドイチャー・ヴァイン)。テーブルワイン。国内産ブドウを使用。", lang: 'de-DE' },
            'Landwein': { text: "Landwein (ラントヴァイン)。地酒。指定地域のブドウを85%以上使用。", lang: 'de-DE' },
            'Qualitätswein': { text: "Qualitätswein (クヴァリテーツヴァイン)。指定地域の高品質ワイン。補糖可能。", lang: 'de-DE' },
            'Prädikatswein': { text: "Prädikatswein (プレディカーツヴァイン)。肩書き付き上級ワイン。補糖は一切禁止。", lang: 'de-DE' },
            'Port': { text: "Port (ポートワイン)。ポルトガル・ドウロ地方の酒精強化ワイン。", lang: 'pt-PT' },
            'Ruby Port': { text: "Ruby (ルビーポート)。酸化させず、果実味を保った若いポート。", lang: 'en-GB' },
            'Tawny Port': { text: "Tawny (トゥニーポート)。樽で酸化熟成させた、黄褐色のポート。", lang: 'en-GB' },
            'Vintage Port': { text: "Vintage (ヴィンテージポート)。最良の年のみ造られ、瓶内で長期間熟成する。", lang: 'en-GB' },
            'Madeira': { text: "Madeira (マデイラ)。加熱熟成（Estufagem）を経た、半永久的な寿命を持つワイン。", lang: 'pt-PT' },
            'Rioja': { text: "Rioja (リオハ)。スペインで最も有名なワイン産地。", lang: 'es-ES' },
            'Rioja Alta': { text: "Rioja Alta。リオハ西部の高地。", lang: 'es-ES' },
            'Rioja Alavesa': { text: "Rioja Alavesa。バスク州側のリオハ。", lang: 'es-ES' },
            'Rioja Oriental': { text: "Rioja Oriental。東部の温暖なエリア。", lang: 'es-ES' },
            'Crianza': { text: "Crianza (クリアンサ)。熟成規定の一つ。", lang: 'es-ES' },
            'Reserva': { text: "Reserva (レセルバ)。長期熟成規定。", lang: 'es-ES' },
            'Gran Reserva': { text: "Gran Reserva (グラン・レセルバ)。最長の熟成規定。", lang: 'es-ES' },
            'Ribera del Duero': { text: "Ribera del Duero (リベラ・デル・ドゥエロ)。", lang: 'es-ES' },
            'Priorat': { text: "Priorat (プリオラート)。", lang: 'ca' },
            'Rias Baixas': { text: "Rias Baixas (リアス・バイシャス)。", lang: 'gl' },
            'Llicorella': { text: "Llicorella (リコレラ)。粘板岩土壌。", lang: 'ca' },
            'Flor': { text: "Flor (フロール)。産膜酵母。", lang: 'es-ES' },
            'Fino': { text: "Fino (フィノ)。", lang: 'es-ES' },
            'Manzanilla': { text: "Manzanilla (マンサニーリャ)。", lang: 'es-ES' },
            'Amontillado': { text: "Amontillado (アモンティリャード)。", lang: 'es-ES' },
            'Palo Cortado': { text: "Palo Cortado (パロ・コルタド)。", lang: 'es-ES' },
            'Oloroso': { text: "Oloroso (オロロソ)。", lang: 'es-ES' },
            'Pedro Ximénez': { text: "Pedro Ximénez (ペドロ・ヒメネス)。", lang: 'es-ES' },
            'Cream': { text: "Cream (クリーム)。甘口シェリー。", lang: 'en-GB' },
            'Mosel': { text: "Mosel (モーゼル)。", lang: 'de-DE' },
            'Steep Slope': { text: "急斜面。", lang: 'en-US' },
            'Rheingau': { text: "Rheingau (ラインガウ)。", lang: 'de-DE' },
            'Pfalz': { text: "Pfalz (ファルツ)。", lang: 'de-DE' },
            'Grosse Lage': { text: "Grosse Lage (グローセ・ラーゲ)。特級畑。", lang: 'de-DE' },
            'Erste Lage': { text: "Erste Lage (エルステ・ラーゲ)。一級畑。", lang: 'de-DE' },
            'Grosses Gewächs': { text: "Grosses Gewächs (グローセス・ゲヴェックス)。特級畑の辛口。", lang: 'de-DE' },
            'Wachau': { text: "Wachau (ヴァッハウ)。", lang: 'de-DE' },
            'Steinfeder': { text: "Steinfeder (シュタインフェーダー)。", lang: 'de-DE' },
            'Federspiel': { text: "Federspiel (フェーダーシュピール)。", lang: 'de-DE' },
            'Smaragd': { text: "Smaragd (スマラクト)。", lang: 'de-DE' },
            'Burgenland': { text: "Burgenland (ブルゲンラント)。", lang: 'de-DE' },
            'Styria': { text: "Styria (シュタイヤーマルク)。", lang: 'de-DE' },
            'Valais': { text: "Valais (ヴァレー)。", lang: 'fr-CH' },
            'Fendant': { text: "Fendant (ファンダン)。", lang: 'fr-CH' },
            'Vaud': { text: "Vaud (ヴォー)。", lang: 'fr-CH' },
            'Chasselas': { text: "Chasselas (シャスラ)。", lang: 'fr-CH' },
            'Tokaj': { text: "Tokaj (トカイ)。", lang: 'hu-HU' },
            'Aszú': { text: "Aszú (アスー)。", lang: 'hu-HU' },
            'Puttonyos': { text: "Puttonyos (プットニョス)。", lang: 'hu-HU' },
            'Essencia': { text: "Essencia (エッセンシア)。", lang: 'hu-HU' },
            'Botrytis': { text: "Botrytis (貴腐菌)。", lang: 'la' },
            'Eger': { text: "Eger (エゲル)。", lang: 'hu-HU' },
            'Egri Bikavér': { text: "Egri Bikavér (エグリ・ビカヴェール)。", lang: 'hu-HU' }
        };

        let currentTerm = "";
        function openGlossary(term) {
            const data = glossaryData[term];
            if (data) {
                currentTerm = term;
                const modal = document.getElementById('glossary-modal');
                document.getElementById('modal-title').innerText = term;
                const audioControls = document.getElementById('modal-audio-controls');
                if (term === 'Oechsle') {
                     audioControls.style.display = 'none';
                } else {
                     audioControls.style.display = 'flex';
                }
                
                document.getElementById('modal-desc').innerText = data.text;
                document.getElementById('modal-header').style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--chapter-color');
                modal.showModal();
                // Auto play correct pronunciation for TBA
                if(term === 'TBA') speakNative('Trockenbeerenauslese', 'de-DE');
            }
        }
        function closeGlossary() { document.getElementById('glossary-modal').close(); window.speechSynthesis.cancel(); }
        
        function speakNative(text, lang) {
            if (!('speechSynthesis' in window)) return;
            window.speechSynthesis.cancel();
            setTimeout(() => {
                const u = new SpeechSynthesisUtterance(text);
                u.lang = lang; u.rate = 0.9;
                window.speechSynthesis.speak(u);
            }, 10);
        }

        function speakJP(text) {
            if (!('speechSynthesis' in window)) return;
            window.speechSynthesis.cancel();
            setTimeout(() => {
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'ja-JP';
                u.rate = 1.0;
                window.speechSynthesis.speak(u);
            }, 10);
        }

        function playCurrentTermAudio() { 
            if(currentTerm === 'TBA') {
                speakNative('Trockenbeerenauslese', 'de-DE');
            } else if(glossaryData[currentTerm]) {
                speakNative(currentTerm, glossaryData[currentTerm].lang);
            }
        }

        // --- Quiz Logic (50% Module / 50% Review) ---
        const moduleQuestions = [
            { q: "ドイツの「Trockenbeerenauslese」の特徴は？", options: ["氷結ブドウ", "貴腐ブドウ", "遅摘み", "早摘み"], a: 1, exp: "貴腐化した干し葡萄状の粒から造られます。" },
            { q: "ポルトガルの「ポートワイン」で、樽熟成により酸化したタイプは？", options: ["Ruby", "Vintage", "Tawny", "White"], a: 2, exp: "Tawny（トゥニー）ポートです。" },
            { q: "スペイン・プリオラート地方の土壌名は？", options: ["Albariza", "Llicorella", "Kimmeridgian", "Loess"], a: 1, exp: "Llicorella（リコレラ）と呼ばれる粘板岩です。" },
            { q: "オーストリア・ヴァッハウの格付けで最上級は？", options: ["Steinfeder", "Federspiel", "Smaragd", "Reserve"], a: 2, exp: "Smaragd（スマラクト）です。" },
            { q: "ハンガリーのトカイワインに使われる主要品種は？", options: ["Riesling", "Furmint", "Chardonnay", "Merlot"], a: 1, exp: "Furmint（フルミント）です。" },
            { q: "スイス・ヴァレー州でのシャスラの呼び名は？", options: ["Fendant", "Dôle", "Heida", "Amigne"], a: 0, exp: "Fendant（ファンダン）と呼ばれます。" }
        ];
        const reviewQuestions = [
            { q: "ボルドー左岸の主要品種は？", options: ["Merlot", "Cabernet Sauvignon", "Pinot Noir", "Syrah"], a: 1, exp: "カベルネ・ソーヴィニヨンです。" },
            { q: "シャンパーニュの瓶内二次発酵工程で、澱を取り除く作業は？", options: ["Remuage", "Degorgement", "Dosage", "Assemblage"], a: 1, exp: "Degorgement（デゴルジュマン）です。" },
            { q: "ブルゴーニュ地方の「コート・ドール」は、北の何と南の何に分かれる？", options: ["Nuits & Beaune", "Chalonnais & Maconnais", "Rhone & Loire", "Medoc & Graves"], a: 0, exp: "コート・ド・ニュイとコート・ド・ボーヌです。" },
            { q: "マロラクティック発酵(MLF)の主な効果は？", options: ["酸味の強化", "減酸と風味の複雑化", "アルコール度数の上昇", "糖分の分解"], a: 1, exp: "リンゴ酸を乳酸に変え、酸味を和らげます。" },
            { q: "赤ワインの醸造で、果皮を果汁に漬け込む工程は？", options: ["Pressurage", "Maceration", "Collage", "Soutirage"], a: 1, exp: "Maceration（マセラシオン/醸し）です。" },
            { q: "ボルドーの格付けで唯一、例外的に昇格したシャトーは？", options: ["Mouton Rothschild", "Lafite Rothschild", "Latour", "Margaux"], a: 0, exp: "シャトー・ムートン・ロートシルト（1973年昇格）です。" }
        ];

        let currentQuizQuestions = [], currentQuestionIndex = 0, score = 0;

        function startQuiz() {
            // Pick 5 from Module, 5 from Review (Total 10) for demo.
            const q1 = [...moduleQuestions].sort(()=>0.5-Math.random()).slice(0,5);
            const q2 = [...reviewQuestions].sort(()=>0.5-Math.random()).slice(0,5);
            currentQuizQuestions = [...q1, ...q2].sort(()=>0.5-Math.random());
            
            document.getElementById('quiz-intro').style.display = 'none';
            document.getElementById('quiz-area').style.display = 'block';
            currentQuestionIndex = 0; score = 0; showQuestion();
        }

        function showQuestion() {
            const qData = currentQuizQuestions[currentQuestionIndex];
            const container = document.getElementById('question-card-container');
            container.innerHTML = `<div class="question-card active">
                <div style="margin-bottom:1rem;color:#888;">Question ${currentQuestionIndex+1}/${currentQuizQuestions.length}</div>
                <p class="question-text">${qData.q}</p>
                <div class="options-grid">${qData.options.map((opt, i) => `<button class="option-btn" onclick="checkAnswer(${i})">${opt}</button>`).join('')}</div>
            </div>`;
        }

        function checkAnswer(i) {
            const qData = currentQuizQuestions[currentQuestionIndex];
            
            const modal = document.getElementById('quiz-feedback-modal');
            const title = document.getElementById('quiz-feedback-title');
            const content = document.getElementById('quiz-feedback-content');
            const header = document.getElementById('quiz-feedback-header');
            const btnContainer = document.getElementById('quiz-next-btn-container');

            if (i === qData.a) { 
                score++; 
                title.innerText = "Excellent!";
                content.innerHTML = `<p style="color:green;font-weight:bold; font-size:1.2rem; margin-bottom:1rem;">正解です。</p><p>${qData.exp}</p>`;
                header.style.backgroundColor = "#27AE60"; // Green
                speakNative("Excellent", "en-US");
            } else { 
                title.innerText = "Non...";
                content.innerHTML = `<p style="color:#C0392B;font-weight:bold; font-size:1.2rem; margin-bottom:1rem;">残念、不正解です。</p><p>正解は「${qData.options[qData.a]}」です。</p><p>${qData.exp}</p>`;
                header.style.backgroundColor = "#C0392B"; // Red
            }

            btnContainer.innerHTML = '';
            const btn = document.createElement('button');
            btn.className = "back-to-map"; 
            btn.style.marginTop = "0";
            btn.innerText = currentQuestionIndex < currentQuizQuestions.length - 1 ? "Next Question" : "View Results";
            btn.onclick = () => {
                modal.close();
                nextQuestion();
            };
            btnContainer.appendChild(btn);

            modal.showModal();
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < currentQuizQuestions.length) showQuestion();
            else {
                document.getElementById('quiz-area').style.display = 'none';
                document.getElementById('quiz-result').style.display = 'block';
                document.getElementById('score-display').innerText = `${Math.round((score/currentQuizQuestions.length)*100)}% (${score}/${currentQuizQuestions.length})`;
            }
        }
    </script>
</body>
</html>